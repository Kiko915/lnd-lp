---
import { Image } from 'astro:assets';
import { Menu, X } from 'lucide-astro';
import logo from '../assets/lndliliw-emblem-primary-shadow.webp';

const { lightBg = false } = Astro.props;
const currentPath = Astro.url.pathname;
const forceLight = ['/privacy-policy', '/terms'].includes(currentPath);

const menuItems = [
    { href: "/", text: "Home" },
    { href: "/about", text: "About Us" },
    { href: "/events", text: "Events" },
    { href: "/news", text: "News" },
    { href: "/gallery", text: "Gallery" },
    { href: "/contact", text: "Contact" },
];
---

<nav class={`fixed w-full z-40 transition-all duration-300 ${forceLight || lightBg ? 'navbar-light' : 'navbar-transparent'}`} id="navbar" transition:persist>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-20">
            <!-- Logo -->
            <div class="flex-shrink-0">
                <a href="/" class="flex items-center space-x-3 group">
                    <div class="relative w-12 h-12 overflow-hidden rounded-lg transition-transform duration-300 group-hover:scale-105">
                        <Image 
                            src={logo} 
                            alt="LND Logo" 
                            class={`w-full h-full object-contain`}
                            width={48}
                            height={48}
                        />
                    </div>
                    <div class="flex flex-col">
                        <span class="text-lg font-bold transition-colors duration-300">LND Liliw</span>
                        <span class="text-xs transition-colors duration-300">Lingkod Ng Dambana</span>
                    </div>
                </a>
            </div>

            <!-- Desktop Navigation -->
            <div class="hidden md:flex items-center space-x-1">
                {menuItems.map(item => (
                    <a href={item.href} class="nav-link">{item.text}</a>
                ))}
                <a href="/join" class="ml-4 inline-flex items-center px-4 py-2 border-2 border-[#FDC83D] bg-[#FDC83D] text-[#205488] font-semibold rounded-lg transition-all duration-300 hover:bg-transparent hover:scale-105">
                    Join Now
                </a>
            </div>

            <!-- Mobile menu button -->
            <button 
                type="button" 
                id="menu-toggle"
                class="mobile-menu-button inline-flex items-center justify-center p-2 rounded-lg transition-colors md:hidden"
                aria-expanded="false"
            >
                <Menu class="h-6 w-6" />
            </button>
        </div>
    </div>

    <!-- Mobile menu -->
    <div class="mobile-menu fixed inset-0 w-full h-screen translate-x-full opacity-0 transition-all duration-300 invisible md:hidden">
        <!-- Backdrop -->
        <div class="fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 transition-opacity duration-300"></div>
        
        <!-- Menu panel -->
        <div class="fixed right-0 top-0 h-full w-full max-w-sm bg-white shadow-xl overflow-y-auto">
            <div class="sticky top-0 h-20 flex items-center justify-end px-4 bg-white border-b">
                <button 
                    type="button"
                    class="close-menu p-2 text-slate-600 hover:text-[#205488] hover:bg-slate-100/50 rounded-lg transition-colors"
                >
                    <X class="h-6 w-6" />
                </button>
            </div>
            
            <div class="px-4 py-6 space-y-2">
                {menuItems.map((item, index) => (
                    <a 
                        href={item.href} 
                        class="mobile-nav-link translate-x-8 opacity-0" 
                        style={`transition-delay: ${index * 50}ms`}
                    >
                        {item.text}
                    </a>
                ))}
                <div class="pt-4 translate-x-8 opacity-0" style="transition-delay: 350ms">
                    <a href="/join" class="block w-full text-center px-4 py-3 bg-[#FDC83D] text-[#205488] font-semibold rounded-lg hover:bg-[#ffd666] transition-colors">
                        Join Now
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<style>
    /* Light background styles */
    .navbar-light {
        @apply bg-white/95 backdrop-blur-sm shadow-md;
    }
    
    .navbar-light .nav-link {
        @apply text-slate-600 hover:text-[#205488] hover:bg-slate-50/50;
    }

    .navbar-light span {
        @apply text-[#205488] first:text-[#205488] last:text-slate-500;
    }

    .navbar-light .mobile-menu-button {
        @apply text-slate-600 hover:text-[#205488] hover:bg-slate-100/50;
    }

    /* Transparent background styles */
    .navbar-transparent {
        @apply bg-transparent;
    }

    .navbar-transparent .nav-link {
        @apply text-white hover:text-white hover:bg-white/10;
    }

    .navbar-transparent span {
        @apply text-white;
    }

    .navbar-transparent .mobile-menu-button {
        @apply text-white hover:text-white hover:bg-white/10;
    }

    .navbar-transparent.navbar-scrolled {
        @apply bg-white/95 backdrop-blur-sm shadow-md;
    }

    .navbar-transparent.navbar-scrolled .nav-link {
        @apply text-slate-600 hover:text-[#205488] hover:bg-slate-50/50;
    }

    .navbar-transparent.navbar-scrolled span {
        @apply text-[#205488] first:text-[#205488] last:text-slate-500;
    }

    .navbar-transparent.navbar-scrolled .mobile-menu-button {
        @apply text-slate-600 hover:text-[#205488] hover:bg-slate-100/50;
    }

    .navbar-transparent.navbar-scrolled img {
        @apply brightness-100 invert-0;
    }

    /* Common styles */
    .nav-link {
        @apply px-4 py-2 font-medium rounded-lg transition-all duration-300 relative after:absolute after:bottom-0 after:left-0 after:h-0.5 after:w-0 after:bg-[#FDC83D] after:transition-all after:duration-300 hover:after:w-full;
    }

    .mobile-nav-link {
        @apply block px-4 py-3 text-slate-600 font-medium rounded-lg hover:text-[#205488] hover:bg-slate-50/50 transition-colors;
    }

    /* Active state */
    .nav-link[aria-current="page"],
    .mobile-nav-link[aria-current="page"] {
        @apply text-[#205488] bg-slate-50/50;
    }

    .nav-link[aria-current="page"]::after {
        @apply w-full;
    }

    /* Join Now button hover state */
    .navbar-transparent .nav-link + a[href="/join"] {
        @apply hover:text-[#205488];
    }

    .mobile-menu {
        transition-property: transform, opacity, visibility;
        transition-duration: 300ms;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 100;
    }

    .mobile-menu.open {
        @apply translate-x-0 opacity-100 visible;
    }

    .mobile-menu.open .bg-black\/50 {
        @apply opacity-100;
    }

    .mobile-menu.open .mobile-nav-link,
    .mobile-menu.open .pt-4 {
        @apply translate-x-0 opacity-100;
    }

    .mobile-nav-link,
    .mobile-menu .pt-4 {
        @apply block px-4 py-3 text-slate-600 font-medium rounded-lg hover:text-[#205488] hover:bg-slate-50/50;
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1),
                    opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
</style>

<script>
    document.addEventListener('astro:page-load', () => {
        const navbar = document.getElementById('navbar');
        const menuToggle = document.getElementById('menu-toggle');
        const closeButton = document.querySelector('.close-menu');
        const mobileMenu = document.querySelector('.mobile-menu');
        const backdrop = document.querySelector('.mobile-menu .bg-black\\/50');

        // Function to update navbar based on current path
        function updateNavbarBackground() {
            const currentPath = window.location.pathname;
            const shouldBeLight = ['/privacy-policy', '/terms'].includes(currentPath);
            
            // Reset all classes first
            navbar?.classList.remove('navbar-light', 'navbar-transparent', 'navbar-scrolled');
            
            // Apply the appropriate class based on the path
            if (shouldBeLight) {
                navbar?.classList.add('navbar-light');
            } else {
                navbar?.classList.add('navbar-transparent');
                // Check scroll position and add scrolled class if needed
                if (window.scrollY > 20) {
                    navbar?.classList.add('navbar-scrolled');
                }
            }
        }

        // Handle scroll events
        function handleScroll() {
            const currentPath = window.location.pathname;
            const shouldBeLight = ['/privacy-policy', '/terms'].includes(currentPath);
            
            if (!shouldBeLight) {
                if (window.scrollY > 20) {
                    navbar?.classList.add('navbar-scrolled');
                } else {
                    navbar?.classList.remove('navbar-scrolled');
                }
            }
        }

        // Update navbar on page load and navigation
        updateNavbarBackground();
        document.addEventListener('astro:after-swap', updateNavbarBackground);
        window.addEventListener('scroll', handleScroll);

        function toggleMenu() {
            mobileMenu?.classList.toggle('open');
            document.body.classList.toggle('overflow-hidden');
        }

        // Toggle menu on button click
        menuToggle?.addEventListener('click', toggleMenu);
        closeButton?.addEventListener('click', toggleMenu);

        // Close menu when clicking backdrop
        backdrop?.addEventListener('click', toggleMenu);

        // Close menu on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && mobileMenu?.classList.contains('open')) {
                toggleMenu();
            }
        });

        // Cleanup event listeners
        return () => {
            window.removeEventListener('scroll', handleScroll);
            document.removeEventListener('astro:after-swap', updateNavbarBackground);
        };
    });
</script> 